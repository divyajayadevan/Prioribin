<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style> #map { height: 500px; } </style>
</head>
<body class="p-4">
    <div class="d-flex justify-content-between">
        <h2>Admin Overview</h2>
        <a href="/" class="btn btn-secondary">Logout</a>
    </div>

    <!-- Add Bin Form -->
    <div class="card my-3 p-3">
        <h5>Add New Bin</h5>
        <form method="POST" class="row g-3">
            <div class="col-md-3"><input type="text" name="bin_id" class="form-control" placeholder="Bin ID (e.g. BIN-002)" required></div>
            <div class="col-md-3"><input type="number" step="any" name="lat" class="form-control" placeholder="Latitude" required></div>
            <div class="col-md-3"><input type="number" step="any" name="lon" class="form-control" placeholder="Longitude" required></div>
            <div class="col-md-3"><button type="submit" class="btn btn-primary w-100">Add Bin</button></div>
        </form>
    </div>

    <div class="row">
        <div class="col-md-4">
            <h4>Bin Status</h4>
            <ul class="list-group">
                {% for bin in bins %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ bin.bin_id }}
                    <span class="badge bg-{{ 'danger' if bin.status == 'Critical' else 'warning' if bin.status == 'Warning' else 'success' }} rounded-pill">
                        {{ bin.fill_level }}%
                    </span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-md-8">
            <div id="map"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([9.9312, 76.2673], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Add markers for all bins from backend
        // (In a real app, use fetch API, here using Jinja loop for simplicity)
        {% for bin in bins %}
            L.circleMarker([{{ bin.location_lat }}, {{ bin.location_lon }}], {
                color: "{{ 'red' if bin.status == 'Critical' else 'orange' if bin.status == 'Warning' else 'green' }}",
                radius: 10
            }).addTo(map).bindPopup("<b>{{ bin.bin_id }}</b><br>Level: {{ bin.fill_level }}%");
        {% endfor %}
    </script>
</body>
</html>